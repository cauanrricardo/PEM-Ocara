<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./style.css">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
    <title>Informações do Caso</title>
    <script>
      // Para usuários jurídicos, esconder EDITAR e ALTERAR PRIVACIDADE, e centralizar ACESSAR
      const usuarioLogadoJSON = sessionStorage.getItem('usuarioLogado');
      if (usuarioLogadoJSON) {
        try {
          const usuarioLogado = JSON.parse(usuarioLogadoJSON);
          const cargo = usuarioLogado.cargo ? usuarioLogado.cargo.toLowerCase() : '';
          
          if (cargo.includes('juridico')) {
            const style = document.createElement('style');
            style.textContent = `
              #editar-form,
              #alterar-privacidade {
                display: none !important;
              }
              .botoes-principais {
                display: flex !important;
                justify-content: center !important;
              }
            `;
            document.head.appendChild(style);
          }
        } catch (error) {
          console.error('Erro ao verificar cargo na inicialização:', error);
        }
      }
    </script>
</head>
<body>
    <div class="app-container">
        <aside class="sidebar">
        <header class="sidebar-header">
            <h1>PEM OCARA</h1>
            <hr class="sidebar-divider" />
        </header>

        <nav class="sidebar-nav">
            <ul>
                <li id="listarAssistidas" data-window-target="telaListarAssistidas">
                    <a href="#" class="active">
                        <span class="material-symbols-outlined">person_2</span>
                        <span>Assistidas</span>
                    </a>
                </li>

                <li id="telaRedeApoio" data-window-target="telaRedeApoio">
                    <a href="#">
                        <span class="material-symbols-outlined">groups</span>
                        <span>Rede de Apoio</span>
                    </a>
                </li>

                <li id="telaInicial" data-window-target="telaInicial">
                    <a href="#">
                        <span class="material-symbols-outlined">home</span>
                        <span>Inicial</span>
                    </a>
                </li>

                <li id="telaEstatisticas" data-window-target="telaEstatisticas">
                    <a href="#">
                        <span class="material-symbols-outlined">monitoring</span>
                        <span>Estatísticas</span>
                    </a>
                </li>

                <li id="telaConta" data-window-target="telaConfiguracoesConta">
                    <a href="#">
                        <span class="material-symbols-outlined">manage_accounts</span>
                        <span>Conta</span>
                    </a>
                </li>
            </ul>
        </nav>
      </aside>

        <main class="main-content">
            <div class="title">
                <h1>Informações sobre o Caso <span id="Protocolo"></span></h1>
                <button id="fecharInformacoes"><span class="material-symbols-outlined">close</span></button>
            </div>

            <div class="botoes-principais">
                <button id="acessar-form">ACESSAR FORMULÁRIO</button>
                <button id="editar-form">EDITAR FORMULÁRIO</button>
                <button id="alterar-privacidade">ALTERAR PRIVACIDADE</button>
            </div>

            <div class="infos">
                <p>Assistida: <span id="Assistida"></span></p>
                <p>Agressor: <span id="Agressor"></span></p>
                <p>Data de abertura do Caso: <span id="DataCadastro"></span></p>
                <p>Status do Caso na Assistência Social: 
                    <select name="status" id="StatusAssistenciaSelect">
                        <option value="arquivado">Caso Arquivado</option>
                        <option value="aberto" selected>Caso Aberto</option>
                    </select>
                </p>
                <p>Status do Caso no Processo Jurídico: <span id="StatusJuridico"></span></p>
                <p>Tipo de Violência: <span id="TipoViolencia"></span></p>
            </div>

            <div class="provas">
                <h1>Provas do Caso:</h1>
                <ul id="lista-anexos"></ul>
                <button id="anexar-prova">ANEXAR NOVA PROVA</button>
            </div>

            <div class="provas">
                <h1>Relatórios do Caso:</h1>
                <ul id="lista-relatorios"></ul>
                <button id="anexar-relatorio">ANEXAR NOVO RELATÓRIO</button>
            </div>

            <div id="divisao"></div>

            <div class="redes">
                <h1>Redes de Apoio Contatadas:</h1>
                <p id="redes-contatadas"></p>
                <button id="encaminhamento">GERAR NOVO ENCAMINHAMENTO PARA A REDE</button>
            </div>

            <footer class="rodape d-flex justify-content-between align-items-center flex-wrap mt-auto px-5">
                <img
                    src="img/logo-ocara.png"
                    alt="Logo Ocara"
                    class="logo-esquerda"
                />

                <p>
                    Avenida Coronel João Felipe, Centro <br />
                    CEP 62755-000 – Ocara-CE <br />
                    pemocara@gmail.com
                </p>

                <img
                    src="img/brasao-ocara.png"
                    alt="Brasão Ocara"
                    class="logo-direita"
                />
            </footer>
        </main>
    </div>

    <div id="popup-upload" class="popup-overlay">
        <div class="popup-content">
            <button id="fechar-popup" class="btn-fechar-popup">
                <span class="material-symbols-outlined">close</span>
            </button>
            
            <h2>Anexar Arquivo</h2>
            
            <div id="drop-zone" class="drop-zone">
                <span class="material-symbols-outlined icon-upload">upload_file</span>
                <p class="texto-arraste">Arraste e Solte os Arquivos Aqui</p>
                <p class="info-formatos">Arquivos Suportados: PDF, DOCX, TXT, JPEG, PNG, MP3, M4A, MP4, ZIP</p>
                <button id="btn-selecionar-arquivo" class="btn-selecionar">Escolher Arquivo</button>
                <p class="info-tamanho">Tamanho Máximo para arquivo: 100MB</p>
            </div>
            
            <input type="file" id="file-input" style="display: none;" accept=".pdf,.docx,.txt,.jpg,.jpeg,.png,.mp3,.m4a,.mp4,.zip" multiple>
        </div>
    </div>

    <div class="popup-confirmacao" id="popupConfirmacao">
        <div class="popup-confirmacao-content">
            <p id="popupMensagem"></p>
            <button class="popup-btn-ok" id="popupBtnOk">OK</button>
        </div>
    </div>

    <div class="popup-confirmacao" id="popupConfirmar">
        <div class="popup-confirmacao-content">
            <p id="popupConfirmarMensagem"></p>
            <div class="popup-botoes">
                <button class="popup-btn-cancelar" id="popupBtnCancelar">Cancelar</button>
                <button class="popup-btn-confirmar" id="popupBtnConfirmar">Confirmar</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="modalEncaminhamento">
        <div class="modal-content"> 
            <div class="modal-header">
                <h3 class="modal-title">Novo Email de Encaminhamento</h3>
                <button type="button" class="modal-close" id="fecharModalEncaminhamento">&times;</button>
            </div> 

            <div class="modal-body">
                <div class="form-group">
                    <select id="email-para">
                        <option value="" disabled selected>Para</option>
                    </select>
                </div>
                <div class="form-group">
                    <input type="text" id="email-assunto" placeholder="Assunto">
                </div>
                <div class="form-group">
                    <textarea id="email-corpo" placeholder="Digite algo aqui..."></textarea>
                </div>
            </div> 

            <div class="modal-footer">
                <div class="modal-footer-left">
                    <button type="button" class="modal-icon" id="botaoAnexo">
                        <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#63468C">
                            <path d="M640-520v-200h80v200h-80ZM440-244q-35-10-57.5-39T360-350v-370h80v476Zm30 164q-104 0-177-73t-73-177v-370q0-75 52.5-127.5T400-880q75 0 127.5 52.5T580-700v300h-80v-300q-1-42-29.5-71T400-800q-42 0-71 29t-29 71v370q-1 71 49 120.5T470-160q25 0 47.5-6.5T560-186v89q-21 8-43.5 12.5T470-80Zm170-40v-120H520v-80h120v-120h80v120h120v80H720v120h-80Z"/>
                        </svg>
                    </button>
                    <span id="nome-anexo-modal"></span>
                </div>

                <button class="btn-enviar" id="btnEnviarEncaminhamento" type="button">Enviar</button>
            </div>
            
            <div class="menu-anexos" id="menuAnexos" style="display: none;">
                <div class="menu-anexos-header">
                    <h4>Selecionar Anexos do Caso</h4>
                    <button type="button" class="fechar-menu-anexos" id="fecharMenuAnexos">&times;</button>
                </div>

                <div class="menu-anexos-body" id="listaAnexosModal"></div>
            </div>
        </div> 
    </div>

    <div class="modal-overlay" id="modalPrivacidade">
        <div class="modal-privacidade-content">
            <span class="modal-close" id="fecharModalPrivacidade">&times;</span>
            
            <h1>Selecione a privacidade desse Anexo</h1>
            
            <div class="opcoes-privacidade">
                <label>
                    <input type="radio" name="privacidade" value="publico">
                    Anexo público (disponível para assistente social e para jurídico)
                </label>
                <label>
                    <input type="radio" name="privacidade" value="restrito" checked>
                    Anexo privado (disponível apenas para assistente social)
                </label>
            </div>

            <button>Salvar Alterações</button>
        </div>
    </div>

    <div class="modal-overlay" id="modalEditarFormulario">
        <div class="modal-editar-formulario-content">
            <span class="modal-close" id="fecharModalEditarFormulario">&times;</span>
            
            <h1>Selecione qual(is) etapa(s) você deseja editar</h1>
            
            <div class="opcoes">
                <label>
                    <input type="checkbox" name="etapa" value="dados-assistida">
                    Dados da Assistida
                </label>

                <label>
                    <input type="checkbox" name="etapa" value="dados-caso">
                    Dados do Caso
                </label>

                <label>
                    <input type="checkbox" name="etapa" value="outras-informacoes">
                    Outras informações e encaminhamentos
                </label>

                <label>
                    <input type="checkbox" name="etapa" value="observacoes">
                    Campo de preenchimento profissional e violências encontradas
                </label>
            </div>

            <button id="modal-editar-form">Editar Etapas Selecionadas</button>
            
        </div>
    </div>

    <div class="modal-overlay" id="modalPrivacidadeFormulario">
        <div class="modal-privacidade-formulario-content">
            <div class="title">
                <h1>Privacidade do Formulário</h1>
                <button class="modal-close" id="fecharModalPrivacidadeFormulario">&times;</button>
            </div>
            
            <div class="opcoes-padrao">
                <h2>Visibilidade Padrão</h2>
                <div opcao>
                    <p>Definir todas as etapas como:</p>
                    <div class="segmented-control">
                        <input type="radio" name="visibilidade-padrao" id="privado-padrao" checked>
                        <label for="privado-padrao">Privado</label>
                        
                        <input type="radio" name="visibilidade-padrao" id="publico-padrao">
                        <label for="publico-padrao">Público</label>
                    </div>
                </div>
            </div>

            <div class="opcoes-padrao">
                <h2>Visibilidade das Etapas Específicas</h2>
                <div opcao>
                    <p>Cadastro da Assistida:</p>
                    <div class="segmented-control">
                        <input type="radio" name="visibilidade-assistida" id="privado-assistida" class="visibilidade-etapa" checked>
                        <label for="privado-assistida">Privado</label>

                        <input type="radio" name="visibilidade-assistida" id="publico-assistida" class="visibilidade-etapa">
                        <label for="publico-assistida">Público</label>
                    </div>
                </div>
                <div opcao>
                    <p>Cadastro do Caso:</p>
                    <div class="segmented-control">
                        <input type="radio" name="visibilidade-caso" id="privado-caso" class="visibilidade-etapa" checked>
                        <label for="privado-caso">Privado</label>
                        
                        <input type="radio" name="visibilidade-caso" id="publico-caso" class="visibilidade-etapa">
                        <label for="publico-caso">Público</label>
                    </div>
                </div>
                <div opcao>
                    <p>Outras Informações e Encaminhamentos:</p>
                    <div class="segmented-control">
                        <input type="radio" name="visibilidade-outras" id="privado-outras" class="visibilidade-etapa" checked>
                        <label for="privado-outras">Privado</label>
                        
                        <input type="radio" name="visibilidade-outras" id="publico-outras" class="visibilidade-etapa">
                        <label for="publico-outras">Público</label>
                    </div>
                </div>
                <div opcao>
                    <p>Campo para o preenchimento profissional e tipos de violência identificadas:</p>
                    <div class="segmented-control">
                        <input type="radio" name="visibilidade-profissional" id="privado-profissional" class="visibilidade-etapa" checked>
                        <label for="privado-profissional">Privado</label>
                        
                        <input type="radio" name="visibilidade-profissional" id="publico-profissional" class="visibilidade-etapa">
                        <label for="publico-profissional">Público</label>
                    </div>
                </div>
            </div>

            <button id="modal-privacidade-form">Salvar Alterações</button>
        </div>
    </div>

    <script src="../../../dist/utils/sidebarNavigation.js"></script>
    <script src="script.js"></script>
    <script type="module" src="../../../dist/renderers/informacoesCasoRenderer.js"></script>
</body>
</html>